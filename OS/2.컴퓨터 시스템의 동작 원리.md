# 2. 컴퓨터 시스템의 동작 원리

## 컴퓨터 시스템의 구조
- 컴퓨터 내의 각 하드웨어 장치에는 **컨트롤러**가 있다. **컨트롤러**는 일종의 작은 CPU로서 각 하드웨어 장치마다 이들을 제어한다. ( 메모리 컨트롤러, 디스크 컨트롤러.. 등)
- 운영 체제는 여러 프로그램이 동시에 수행되는 시스템을 위한다. 프로그램이 메모리에 올라가 있어야 수행되는데, 운영체제는 컴퓨터가 부팅될 때부터 수행되면서 각종 자원들을 관리해야 하므로 항상 메모리에 올라가 있다. 
- 운영체제 중 항상 메모리에 올라가 있는 부분은 전체 운영 체제 중 일부분에 해당하는데 이 부분을 **커널** 이라고 한다.


## CPU와 I/O 연산
- 입출력 장치들의 I/O 연산은 I/O 컨트롤러가 담당하고 컴퓨터 내에서 수행되는 연산은 메인 CPU가 담당한다.
- 입출력 장치와 메인 CPU는 동시 수행이 가능한다. ( A프로그램이 CPU를 할당받아 코드를 수행중 & B프로그램은 HDD에서 정보를 읽어오는 작업 )
- 각 장치의 장치 컨트롤러에는 장치로부터 들어오고 나가는 데이터를 임시로 저장하기 위한 작은 메모리인 **로컬 버퍼**를 갖고 있다.
- 디스크나 키보드에서 데이터를 읽어오는 경우 이 로컬 버퍼에 데이터가 임시로 저장된 후 메모리에 전달한다.
- 장치에서 로컬 버퍼로 읽어오는 일을 컨트롤러가 담당한다.
- 각 장치의 컨트롤러가 버퍼에 데이터 준비가 다 끝나면 **인터럽트**를 통해 **CPU**에게 보고하게 된다.
- **인터럽트**란 컨트롤러가 CPU의 서비스를 필요로 할 때 각 장치의 컨트롤러가 통보하는 방법이다.
- CPU는 명렁 하나를 수행할 때마다 인터럽트 라인을 통해서 인터럽트가 발생했는지 체크하고 발생했으면 처리한다.


## 인터럽트의 일반적 기능
- 컨트롤러가 로컬 버퍼로 다 읽어 온 후 인터럽트를 발생시키면 CPU는 인터럽트가 들어옴을 인지하고 인터럽트 관련 업무 수행한다.
- 커널에는 인터럽트가 들어왔을 때 해야할 일을 미리 다 프로그래밍해서 보관하고 있다.
- 그 중 한가지가 인터럽트 처리 루틴이다. 인터럽트 처리 루틴은 다양한 인터럽트에 대해 처리해야 할 업무를 정의한다.
- 인터럽트 처리 루틴을 통해 인터럽트 처리를 완료하고 나면 원래 수행하던 작업으로 돌아간다.
- 돌아갈 위치와 인터럽트 처리전에 수행중이던 작업을 저장해두는 저장소를 별도로 갖고 있다.


## 메모리 주소
- 메모리 주소는 크게 코드(code), 데이터, 스택(stack) 등의 영역으로 나뉜다.
- 스택은 실행중인 함수에서 다른 함수를 호출한 경우 호출된 함수의 종료 후 원래 실행중이던 위치로 돌아가기 위한 **복귀 주소**를 저장하는 영역이다.
- 데이터 영역은 전역 변수 등 프로그램이 사용하는 각종 데이터가 저장되는 공간이다.
- 코드 부분은 프로그래머가 작성한 코드가 기계어 명령 형태로 저장되는 영역이다. CPU는 매 시점 코드 부분에 있는 명령을 하나씩 읽어와 수행한다.


## 인터럽트 종류
- 하드웨어 인터럽트 : 각종 하드웨어 장치들이 **CPU에게 서비스를 받아야 하는 경우**에 인터럽트 라인을 통해 CPU에게 전달
- 소프트웨어 인터럽트 : 프로그램이 수행되다가 접근해서는 안되는 메모리 영역을 침범하는 경우, 0으로 나누는 연산 등 예외 상화이나 시스템 콜 시에 발생
- 소프트웨어 인터럽트는 프로그램이 잘못된 연산을 수행하는 경우 그것에 대한 **예외 처리**와
 프로그램 자신이 작성하지 않은 코드를 운영체제로부터 서비스 받기 위해 발생시키는 **시스템 콜**로 나누어 볼 수 있다.


## 동기식 입출력
- 입출력을 요청한 프로그램은 입출력이 완료될 때까지 다음 명령을 수행할 수 없기 때문에 그동안 CPU가 낭비된다.
- CPU의 효율적인 사용을 위해 입출력이 수행되는 동안 다른 프로그램에 CPU를 양도하면 동시에 다수의 입출력 연산이 일어날 수 있다.
- 각 장치(키보드, 마우스.. )마다 **큐(Queue)** 를 두어 요청된 순서대로 처리할 수 있도록 한다.
- 각 장치의 컨트롤러는 큐의 순서에 따라 자신에게 주어진 입출력 작업을 처리한다.
- 인터럽트를 통하여 CPU에게 연산 완료 통보를 하며, 이때 커널은 인터럽트 처리 루틴으로 가서 입출력 연산을 끝낸 프로그램이 CPU를 할당받도록 한다.


## 비동기식 입출력
- 입출력 연산을 요청한 후에 연산이 끝나기를 기다리는 것이 아니라 CPU의 제어권을 입출력 연산을 호출한 프로그램에게 곧바로 부여하는 방식이다.
- 어떤 프로그램이 데이터를 디스크에서 읽어오라고 요청하면, 읽어온 데이터가 없어도 수행할 수 있는 일을 먼저 수행하고 나머지 일을 입출력이 완료된 후에 수행한다.


## DMA( Direct Memory Access )
- 원칙적으로 메모리는 CPU에 의해서만 접근이 가능하여 주변 장치들이 메모리에 접근하기 위해서는 CPU에게 인터럽트를 발생시켜 CPU가 일을 대행하는 식으로 가능하다.
- 장치의 컨트롤러가 CPU에게 인터럽트를 발생시키면 CPU는 컨트롤러의 로컬 버퍼와 메모리 사이에서 데이터를 옮겨 주는 일을 한다.
- CPU가 모든 일을 다하는것은 비효율적이므로 효율성을 위해 CPU 이외에 메모리에 접근 가능한 장치인 DMA를 둔다.
- **DMA가 로컬 버퍼에서 메모리로 읽어 오는 작업**을 대신한다. 결국 입출력 연산을 더욱 빠르게 수행한다.


## 저장 장치의 계층 구조
- 저장 장치는 빠른 저장 장치(Register, Cache memory, Main memory) = 휘발성, 느린 저장장치(Magnetic disk, Optical disk, Magnetic tape) = 비휘발성 으로
단계적인 계층 구조로 이루어진다. 당장 필요한 정보는 빠른 장치에 넣어 수행 속도를 올리고, 그렇지 않은 정보는 느린 장치에 보관한다.
- **캐싱 기법**을 통해 적은 용량의 캐쉬 메모리를 사용해도 메인 메모리와 같은 큰 용량을 가진 것처럼 효율적으로 관리할 수 있다.
- **캐싱 기법**은 캐쉬 메모리 뿐만 아니라 상대적으로 용량이 적은 빠른 저장 장치의 성능 향상을 위한 기법이다.
- 빠른 저장 장치에 자주 사용될 데이터를 저장하면 필요한 정보를 빠른 저장 장치에서 곧바로 찾을 수 있어 성능이 향상된다.

  



출처 : 운영 체제와 정보기술의 원리 - 반효경