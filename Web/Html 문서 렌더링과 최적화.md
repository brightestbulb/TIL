# 웹 브라우저에서 HTML 문서를 어떻게 렌더링 할까?

## 웹 브라우저의 HTML문서 렌더링 과정
1. HTML 파싱과 DOM 트리 구성 : 사용자가 페이지를 요청하면 네트워크를 통해 마크업을 받아온다. 그리고 마크업 문자열을 토큰 형태로 잘라서 트리를 구축하고 파싱 작업을 시작한다. 그런 다음 DOM 트리를 생성한다.
2. 렌더 트리 구성(DOM + Style 규칙) : DOM 트리를 생성한 다음 Style Sheet 규칙을 적용하여 렌더 트리를 만든다. display:none 속성처럼 DOM 트리에는 있지만 화면에 보이면 안되는 요소를 걸러낸것이 렌더 트리이다.
3. 렌더 트리의 배치 : 최종적으로 스타일 규칙에 따라 각 요소를 화면 어느곳에 배치할지 좌표를 설정한다.
4. 렌더 트리 그리기 : 요소의 좌표가 설정되면 브라우저에 순차적으로 화면을 그린다. 


# 렌더링 성능 향상

## CSS파일은 위에 Script는 아래에 두자
문서를 파싱해서 DOM Tree를 만들어도 스타일 규칙이 없으면 렌더링을 할 수가 없다. StyleSheet 파일을 빨리 다운 받아서 스타일 규칙을 알아내야 렌더링 트리가 빨리 만들어진다.
그래서 **head** 태그 사이에 CSS파일을 둔다. **자바스크립트**는 DOM 객체를 이용해서 컴포넌트들을 조작하는데 **head**태그 사이에 Script 파일이 놓이게 되면 
HTML파서가 파싱을 멈추고 Script 파일을 읽기 시작한다. 파싱을 멈추고 읽기 때문에 웹페이지가 그려지는데 시간이 오래걸리게 된다. 따라서 body 태그가 닫히는 부분 위에 스크립트를 모아둔다.


## 초기 렌더링 시 AJAX 요청 최소화

동적인 웹사이트를 화면에서 그리는 단계는 다음과 같다.

1. 사용자가 페이지를 요청한다.
2. 서버에서 보낸 마크업을 다운로드해 렌더링을 시작한다. 이때 마크업은 화면을 구성하는 레이아웃만 있다.
3. 자바스크립트 다운로드와 렌더링이 끝난 후 onload 이벤트가 발생한다.
4. onload 이벤트가 발생한 다음에야 AJAX 통신을 하여 데이터를 받아와 화면에 그린다.
5. 화면이 완성된다.

여기서 문제점은 렌더링이 반복된다는 것이다. 1 ~ 3번 단계까지 전체 화면을 한번 그리고, 4 ~ 5번 단계에서 화면을 한번 더 그린다.
초기 렌더링 시에 마크업 전체를 서버에서 보내는 방식으로 개발해 체감 속도를 높일 수 있다. 1 ~ 3단계에서 전체 화면과 데이터가 있는 화면을 모두 그리는 것이다.
체감 속도를 높이려면 되도록 초기 렌더링 시에 Ajax 요청을 최소화 해야한다.


## 마크업 최적화
1. 본문 전체를 **table** 태그로 감싸지 않기   
마크업 최적화의 목표는 페이지가 영역별로 하나씩 렌더링되는 것이다. 여러가지 방법 중 table 태그에 대해서 살펴보자.
IE는 table 태그를 렌더링할 때 표 안에 있는 텍스트와 이미지 등을 모두 파싱할 때까지 화면 표를 그리지 않는다.
즉 table 태그가 파싱이 끝난 다음에야 그리게 된다. table 태그를 안쓰는게 좋고, 써야한다면 본문을 최소한으로 감싸는게 좋다.
 
2. 태그의 중첩을 최소화   
전체 태그의 개수를 줄이고 부분적으로는 중첩된 태그를 최소화해 간결하게 디자인하는 것이 렌더링 속도를 높일수 있다.

3. CSS, JS 파일을 외부로 분리하기   
javascript, css 파일을 문서내에 배치하는 것보다 외부로 분리하여 link, script 태그로 불러오는 방식을 사용하여 응답시간을 줄일 수 있다.
브라우저에 의해 캐시에 저장된 javascript, css 파일은 재사용되어 사용되기 때문이다.

4. JS, CSS 통합하기   
외부로 분리한 파일들을 최대한 통합하여 파일 갯수를 줄이는 것 또한 중요하다. 아무리 작은 파일이라도 사용자의 컴퓨터로 가져오기 위해서는 요청을 해야하고
요청이 많아지면 응답 시간 또한 늘어나게 되기 때문이다.

5. JS, CSS 축소   
javascript, css 작성 시 불필요한 선언을 하지 않는 것 역시 파일 용량을 줄이고, 렌더링 속도를 빠르게 할 수 있는 방법이다.
불필요한 공백을 제거하여 용량을 줄이고 필요한 정보만 한줄로 보내기 때문에 트래픽 사이즈가 상당히 줄어들게 된다.

6. 중복 Script 제거하기   
한 페이지에서 동일한 javascript 파일을 두번 포함시키는 것은 성능에 큰 영향을 미친다. 두가지 중요 요소(스크립트 크기&개수)는 단일 웹페이지에서 스크립트 복제 가능성을
증가시킵니다. 그럼 복제 스크립트는 불필요한 HTTP 요청과 자바스크립트 실행의 생성으로 인해 성능에 영향을 준다.

7. 리다이렉트 피하기   
리다이렉트는 페이지를 더 느리게 만든다. 리다이렉트가 완료되고 HTML 문서가 다운로드 될때까지 브라우저 화면에 아무것도 보이지 않는다.
리다이렉트는 HTML 문서 자체의 다운로드를 지연시키기 때문에 가장 안좋다고 할 수 있다.

8. DOM 요소의 수를 줄이자   
복잡한 페이지는 더 많은 바이트를 다운로드 하는 것을 의미하고, 자바스크립트에서 느린 DOM 접근을 의미한다.
레이아웃을 위해서 중첩된 테이블을 사용하고 레이아웃 문제를 해결하기 위해 더 많은 div를 쓰고 있는건 아닌지 생각해봐야 한다.
좋은 마크업을 하기 위해서도 불필요한 요소들을 제거하여 마크업을 하는 것이 중요하다.

9. DOM 접근을 최소화 하기   
자바스크립트의 DOM 객체는 자바스크립트의 주요 성능 저하 요인 중 하나이다. 따라서 자바스크립트의 성능을 최적화하기 위해서는 DOM 객체에 접근을 최소화 해야한다.

10. @import 보다 <link>를 사용하라   
점진적 렌더링을 위해서 CSS가 페이지의 상단에 와야 한다고 했다. IE에서 @Import는 태그를 페이지의 하단에 사용하는 것과 같으므로 최적의 사용방법이 아니다.